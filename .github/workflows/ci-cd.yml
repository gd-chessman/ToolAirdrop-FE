name: Frontend CI/CD

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  # Job 1: Build & Test
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build production
      run: npm run build
      env:
        NODE_ENV: production
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: dist
        path: dist/
        retention-days: 7
        
    - name: Build success notification
      run: |
        echo "âœ… Frontend build successful!"
        echo "ğŸ“¦ Build artifacts uploaded"

  # Job 2: Deploy to Vercel (Auto-deploy)
  deploy-info:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    
    steps:
    - name: Deployment information
      run: |
        echo "ğŸš€ Frontend is ready for deployment!"
        echo ""
        echo "ğŸ“Œ Quick Deploy Options:"
        echo "   1. Vercel (Recommended - Zero Config)"
        echo "      - Connect GitHub repo at: https://vercel.com/new"
        echo "      - Auto-deploys on every push"
        echo "      - Free SSL + CDN"
        echo ""
        echo "   2. Netlify"
        echo "      - Connect at: https://app.netlify.com/start"
        echo "      - Build command: npm run build"
        echo "      - Publish directory: dist"
        echo ""
        echo "   3. GitHub Pages"
        echo "      - Enable in repo Settings > Pages"
        echo "      - Source: GitHub Actions"
        echo ""
        echo "   4. Cloudflare Pages"
        echo "      - Connect at: https://pages.cloudflare.com"

  # Job 3: Preview deployment size
  analyze:
    runs-on: ubuntu-latest
    needs: build
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build
      run: npm run build
      
    - name: Analyze bundle size
      run: |
        echo "ğŸ“Š Build Analysis:"
        du -sh dist/
        echo ""
        echo "ğŸ“ Largest files:"
        find dist -type f -exec du -h {} + | sort -rh | head -10
